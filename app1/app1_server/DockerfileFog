FROM arm32v7/ubuntu:18.04

# set timezone for the system
ENV TZ=Europe/Tallinn
RUN ln -snf /usr/share/zoneinfo/$TZ /etc/localtime && echo $TZ > /etc/timezone

# install necessary ubuntu packages
sudo apt update && sudo apt upgrade
sudo apt install python
sudo apt install python-is-python3
sudo apt-get install python3-pip python3-virtualenv

sudo apt install -y build-essential cmake \
  pkg-config \
  libjpeg-dev \
  libtiff5-dev \
  libpng-dev \
  libavcodec-dev \
  libavformat-dev \
  libswscale-dev \
  libv4l-dev \
  libxvidcore-dev \
  libx264-dev \
  libfontconfig1-dev \
  libcairo2-dev \
  libgdk-pixbuf2.0-dev \
  libpango1.0-dev \
  libgtk2.0-dev \
  libgtk-3-dev \
  libatlas-base-dev \
  gfortran \
  libhdf5-dev \
  libhdf5-serial-dev \
  libhdf5-103 \
  libqt5gui5 \
  libqt5webkit5 \
  libqt5test5 \
  python3-pyqt5 \
  python3-dev

# change pwd
COPY . /app
#RUN rm -rf yolov3_tiny
WORKDIR /app

# download yolov3 weights
RUN wget https://pjreddie.com/media/files/yolov3.weights

# install pip
RUN pip3 install --upgrade pip
RUN pip3 install -r requirements.txt

# set environment variable for yolov3
ENV YOLO_COCO_NAMES=yolov3/coco.names
ENV YOLO_CONFIG=yolov3/yolov3.cfg
ENV YOLO_WEIGHTS=yolov3/yolov3.weights

# run application
ENTRYPOINT [ "python3" ]
CMD [ "app1_server.py" ]
