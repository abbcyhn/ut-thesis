FROM ubuntu:18.04

# set timezone for the system
ENV TZ=Europe/Tallinn
RUN ln -snf /usr/share/zoneinfo/$TZ /etc/localtime && echo $TZ > /etc/timezone

# install necessary ubuntu packages
RUN apt-get update -y && apt-get install -y \
  python3-pip \
  python3-dev \
  python3-opencv \
  wget \
  libglib2.0-0 \ 
  libxrender-dev \ 
  libxext6 \
  cmake

# change pwd
COPY . /app
RUN rm -rf yolov3_tiny
WORKDIR /app

# download yolov3 weights
RUN wget https://pjreddie.com/media/files/yolov3.weights

# install pip
RUN pip3 install --upgrade pip
RUN pip3 install -r requirements.txt

# set environment variable for yolov3
ENV YOLO_COCO_NAMES=yolov3/coco.names
ENV YOLO_CONFIG=yolov3/yolov3.cfg
ENV YOLO_WEIGHTS=yolov3/yolov3.weights

# run application
ENTRYPOINT [ "python3" ]
CMD [ "app1_server.py" ]
