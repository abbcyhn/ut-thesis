FROM arm32v7/ubuntu:18.04

# set timezone for the system
ENV TZ=Europe/Tallinn
RUN ln -snf /usr/share/zoneinfo/$TZ /etc/localtime && echo $TZ > /etc/timezone

# install necessary ubuntu packages
RUN apt update -y && apt upgrade -y

RUN apt install -y build-essential \
  pkg-config \
  libjpeg-dev \
  libtiff5-dev \
  libpng-dev \
  libavcodec-dev \
  libavformat-dev \
  libswscale-dev \
  libv4l-dev \
  libxvidcore-dev \
  libx264-dev \
  libfontconfig1-dev \
  libcairo2-dev \
  libgdk-pixbuf2.0-dev \
  libpango1.0-dev \
  libgtk2.0-dev \
  libgtk-3-dev \
  libatlas-base-dev \
  gfortran \
  libhdf5-dev \
  libhdf5-serial-dev \
  libqt5gui5 \
  libqt5webkit5 \
  libqt5test5 \
  python3-pyqt5 \
  python3-dev \
  python3-pip \
  wget

RUN apt-get install -y apt-transport-https ca-certificates gnupg \
                         software-properties-common wget

#RUN apt-add-repository 'deb https://apt.kitware.com/ubuntu/ bionic main'
RUN apt-get update -y
RUN apt-get install -y cmake

# change pwd
COPY . /app
#RUN rm -rf yolov3_tiny
WORKDIR /app

# download yolov3 weights
RUN wget https://pjreddie.com/media/files/yolov3.weights

# install pip
RUN pip3 install --upgrade pip
RUN pip3 install -r requirements.txt

# set environment variable for yolov3
ENV YOLO_COCO_NAMES=yolov3/coco.names
ENV YOLO_CONFIG=yolov3/yolov3.cfg
ENV YOLO_WEIGHTS=yolov3/yolov3.weights

# run application
ENTRYPOINT [ "python3" ]
CMD [ "app1_server.py" ]
